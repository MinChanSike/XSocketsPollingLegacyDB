var Subscriptions=function(){var n=[],t,i;return this.add=function(i,r,u){var f,e;return(i=i.toLowerCase(),f=this.get(i),f===null)?(e=new t(i),e.addCallback(r,u),n.push(e),1):(f.addCallback(r,u),f.Callbacks.length)},this.get=function(t){if(typeof t!="undefined"){t=t.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].Name===t)return n[i];return null}},this.getAll=function(){return n},this.remove=function(t,i){t=t.toLowerCase();for(var r=0;r<n.length;r++)if(n[r].Name===t)return i===undefined?n.splice(r,1):(n[r].Callbacks.splice(i-1,1),n[r].Callbacks.length===0&&n.splice(r,1)),!0;return!1},this.fire=function(t,i,r,u){if(typeof t!="undefined"){t=t.toLowerCase();for(var f=0;f<n.length;f++)n[f].Name===t&&(u===undefined?n[f].fireCallbacks(i,r):n[f].fireCallback(i,r,u))}},t=function(n){this.Name=n,this.Callbacks=[],this.addCallback=function(t,r){this.Callbacks.push(new i(n,t,r))},this.fireCallback=function(n,t,i){this.Callbacks[i-1].fn(n),typeof this.Callbacks[i-1].state=="object"&&typeof this.Callbacks[i-1].state.options!="undefined"&&typeof this.Callbacks[i-1].state.options.counter!="undefined"&&(this.Callbacks[i-1].state.options.counter.messages--,this.Callbacks[i-1].state.options.counter.messages===0&&typeof this.Callbacks[i-1].state.options.counter.completed=="function"&&this.Callbacks[i-1].state.options.counter.completed()),t&&typeof t=="function"&&t(this.Callbacks[i-1].name)},this.fireCallbacks=function(n,t){for(var i=0;i<this.Callbacks.length;i++)this.fireCallback(n,t,i+1)}},i=function(n,t,i){this.name=n,this.fn=t,this.state=i},this};(function(){"use strict";var n={Delay:20,Events:{onError:"xsockets.onerror",open:"xsockets.xnode.open",close:"close",storage:{set:"xsockets.storage.set",get:"xsockets.storage.get",getAll:"xsockets.storage.getall",remove:"xsockets.storage.remove"},serverstatus:{status:"xsockets.server.status"},onBlob:"blob",connection:{getallclients:"xsockets.getallclients",onclientconnect:"xsockets.onclientconnect",onclientdisconnect:"xsockets.onclientdisconnect",disconnect:"xsockets.disconnect"}},Utils:{getParameterByName:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(window.location.search);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))},extend:function(n,t){var i,r;if(arguments.length>2)for(i=1;i<arguments.length;i++)extend(n,arguments[i]);else for(r in t)n[r]=t[r];return n},guid:function(n,t){for(t=n="";n++<36;t+=n*51&52?(n^15?8^Math.random()*(n^20?16:4):4).toString(16):"-");return t}},WebSocket:function(t,i,r){var f=null,u=this,e=new Subscriptions,s=XSockets.Utils.extend({apikey:null,parameters:{},binaryType:"arraybuffer"},r),h,l;this.connection={},i===undefined&&(t.indexOf("?")===-1?i=t.substring(t.lastIndexOf("/")+1):(h=t.substring(0,t.indexOf("?")),i=h.substring(h.lastIndexOf("/")+1))),this.handler=i,this.channel={};var c={subscribe:"xsockets.subscribe",unsubscribe:"xsockets.unsubscribe",getSubscriptions:"xsockets.getsubscriptions",getAllSubscriptions:"xsockets.getallsubscriptions"},v=function(n){var t="?",i;for(i in n)t+=i+"="+encodeURIComponent(n[i])+"&";return t.slice(0,t.length-1)},o=function(n,t){e.get(n)!==null&&(typeof t=="string"&&(t=JSON.parse(t)),e.fire(n,t,function(){}))},a=function(){return typeof window.WebSocket.CLOSED=="undefined"?"Fallback":"WebSocket"in window&&WebSocket.CLOSED>2?"RFC6455":"Hixie"};return this.close=function(n){this.trigger(XSockets.Events.connection.disconnect,{},n)},this.getSubscriptions=function(){return e.getAll()},this.bind=function(n,t,i,r){var o={options:(i instanceof Function)?{}:i,ready:f.readyState,confirm:(r||i)instanceof Function};return o.ready===1&&u.trigger(new XSockets.Message(c.subscribe,{Event:n,Confirm:o.confirm})),t instanceof Function?e.add(n,t,o):t instanceof Array&&t.forEach(function(t){e.add(n,t,o)}),(typeof r=="function"||typeof i=="function")&&e.add("__"+n,r||i,{options:{ready:2}}),this},this.many=function(n,t,i,r,f){return u.bind(n,i,XSockets.Utils.extend({counter:{messages:t,completed:function(){u.unbind(n)}}},r),f||r),this},this.one=function(n,t,i,r){return u.bind(n,t,XSockets.Utils.extend({counter:{messages:1,completed:function(){u.unbind(n)}}},i),r||i),this},this.unbind=function(n,t){return e.remove(n)&&u.trigger(new XSockets.Message(c.unsubscribe,{Event:n})),t&&typeof t=="function"&&t(),this},this.trigger=function(n,t,i){if(typeof n!="object"&&(arguments.length!==2||typeof t!="function"?arguments.length===1&&(t={}):(i=t,t={})),typeof n!="object"){n=n.toLowerCase();var r=new XSockets.Message(n,t);f.send(r.toString()),i&&typeof i=="function"&&i()}else f.send(n.toString()),t&&typeof t=="function"&&t();return this},this.send=function(n){f.send(n)},"WebSocket"in window&&(a()==="Fallback"?f=new window.WebSocket(t,i):(l=window.localStorage.getItem("XSocketsClientStorageGuid"+i)!==null?window.localStorage.getItem("XSocketsClientStorageGuid"+i):null,l!==null&&(s.parameters.XSocketsClientStorageGuid=l),t=t+v(s.parameters),f=new window.WebSocket(t,i),f.binaryType=s.binaryType)),f!==null&&(u.bind(n.Events.open,function(n){var r,t,f;for(u.connection=n,window.localStorage.setItem("XSocketsClientStorageGuid"+i,n.StorageGuid),r=e.getAll(),t=0;t<r.length;t++)for(f=0;f<r[t].Callbacks.length;f++)r[t].Callbacks[f].state.ready===0&&u.trigger(new XSockets.Message(c.subscribe,{Event:r[t].Name,Confirm:r[t].Callbacks[f].state.confirm}))},{subscribe:!1}),f.onclose=function(n){o("close",n)},f.onopen=function(n){o("open",n)},f.onmessage=function(n){if(typeof n.data=="string"){var t=JSON.parse(n.data);o(t.event,t.data)}else o(XSockets.Events.onBlob,n.data)}),{close:u.close,bind:u.bind,unbind:u.unbind,one:u.one,many:u.many,on:u.bind,off:u.unbind,trigger:u.trigger,triggerBinary:u.send,send:u.send,channel:u.channel,subscribe:u.bind,unsubscribe:u.unbind,publish:u.trigger,emit:u.trigger,subscriptions:u.getSubscriptions,clientType:a()}},Channel:function(){var t=function(t,i,r){var u=n.Utils.guid(),f=t+"/"+u,e=new XSockets.WebSocket(f,i,r);return e.channel={Id:u,args:[f,i,r]},e},i=function(n){return new XSockets.WebSocket(n.args[0],n.args[1],n.args[2])};return{Create:t,Connect:i}}(),Message:function(n,t){var i={event:n,data:JSON.stringify(t)};return this.JSON=function(){return i}(),this.toString=function(){return JSON.stringify(i)},this}};window.jXSockets||(window.jXSockets=n),window.XSockets||(window.XSockets=n)})();
//@ sourceMappingURL=XSockets.latest.min.js.map